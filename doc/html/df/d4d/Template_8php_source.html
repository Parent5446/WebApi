<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WebApi: app/out/Template.php Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="../../dir_a261379d24894f08009c147cca3fa917.html">app</a>&nbsp;&raquo&nbsp;<a class="el" href="../../dir_eb96bd936c2dacad4ca5f311d3036ee6.html">out</a>
  </div>
</div>
<div class="contents">
<h1>Template.php</h1><a href="../../df/d4d/Template_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="keywordflow">if</span>(!defined(<span class="stringliteral">&quot;API&quot;</span>)) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
<a name="l00004"></a>00004 
<a name="l00057"></a><a class="code" href="../../d0/dcf/classOUT__Template.html">00057</a> <span class="keyword">class </span><a class="code" href="../../d0/dcf/classOUT__Template.html">OUT_Template</a>
<a name="l00058"></a>00058 {
<a name="l00063"></a><a class="code" href="../../d0/dcf/classOUT__Template.html#a296bfcd3d6b713859bd81c827d87aa3e">00063</a>         <span class="keyword">private</span> <a class="code" href="../../d0/dcf/classOUT__Template.html#a296bfcd3d6b713859bd81c827d87aa3e">$filename</a>;
<a name="l00064"></a>00064 
<a name="l00069"></a><a class="code" href="../../d0/dcf/classOUT__Template.html#a1c04c575b35949f8146c1a5eef5c2ed7">00069</a>         <span class="keyword">private</span> <a class="code" href="../../d0/dcf/classOUT__Template.html#a1c04c575b35949f8146c1a5eef5c2ed7">$template</a>;
<a name="l00070"></a>00070 
<a name="l00075"></a><a class="code" href="../../d0/dcf/classOUT__Template.html#a60c326b6e906fce16b17436540625a66">00075</a>         <span class="keyword">private</span> <a class="code" href="../../d0/dcf/classOUT__Template.html#a60c326b6e906fce16b17436540625a66">$values</a>;
<a name="l00076"></a>00076 
<a name="l00084"></a><a class="code" href="../../d0/dcf/classOUT__Template.html#ad750e5ccf638adee8a6bcb8794c1eb3f">00084</a>         <span class="keyword">public</span> function <a class="code" href="../../d0/dcf/classOUT__Template.html#ad750e5ccf638adee8a6bcb8794c1eb3f">__construct</a>(<a class="code" href="../../d0/dcf/classOUT__Template.html#a296bfcd3d6b713859bd81c827d87aa3e">$filename</a>) {
<a name="l00085"></a>00085                 <span class="keywordflow">if</span>(<a class="code" href="../../d0/dcf/classOUT__Template.html#a296bfcd3d6b713859bd81c827d87aa3e">$filename</a> instanceof DOMDocument) {
<a name="l00086"></a>00086                         <a class="code" href="../../d0/dcf/classOUT__Template.html#a1c04c575b35949f8146c1a5eef5c2ed7">$template</a> = <a class="code" href="../../d0/dcf/classOUT__Template.html#a296bfcd3d6b713859bd81c827d87aa3e">$filename</a>-&gt;saveHTML();
<a name="l00087"></a>00087                         <a class="code" href="../../d0/dcf/classOUT__Template.html#a296bfcd3d6b713859bd81c827d87aa3e">$filename</a> = <span class="charliteral">&apos;-&apos;</span>;
<a name="l00088"></a>00088                 } elseif(!file_exists(<a class="code" href="../../d0/dcf/classOUT__Template.html#a296bfcd3d6b713859bd81c827d87aa3e">$filename</a>) || !is_readable(<a class="code" href="../../d0/dcf/classOUT__Template.html#a296bfcd3d6b713859bd81c827d87aa3e">$filename</a>)) {
<a name="l00089"></a>00089                         <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="../../d4/d5e/classMAIN__Error.html">MAIN_Error</a>(<a class="code" href="../../d4/d5e/classMAIN__Error.html#af47cc28f788d73c277a78761621fd711">MAIN_Error::WARNING</a>, get_class($this) . <span class="stringliteral">&apos;::__construct&apos;</span>, <span class="stringliteral">&apos;Parameter is not the correct data type.&apos;</span>, $this-&gt;log);
<a name="l00090"></a>00090                 } <span class="keywordflow">else</span> {
<a name="l00091"></a>00091                         <a class="code" href="../../d0/dcf/classOUT__Template.html#a1c04c575b35949f8146c1a5eef5c2ed7">$template</a> = file_get_contents(<a class="code" href="../../d0/dcf/classOUT__Template.html#a296bfcd3d6b713859bd81c827d87aa3e">$filename</a>);
<a name="l00092"></a>00092                 }
<a name="l00093"></a>00093 
<a name="l00094"></a>00094                 $this-&gt;filename = <a class="code" href="../../d0/dcf/classOUT__Template.html#a296bfcd3d6b713859bd81c827d87aa3e">$filename</a>;
<a name="l00095"></a>00095                 $this-&gt;<span class="keyword">template</span> = <a class="code" href="../../d0/dcf/classOUT__Template.html#a1c04c575b35949f8146c1a5eef5c2ed7">$template</a>;
<a name="l00096"></a>00096         }
<a name="l00097"></a>00097 
<a name="l00105"></a><a class="code" href="../../d0/dcf/classOUT__Template.html#a2f0cd6dd6fe55fbc4926cfa10bf48abb">00105</a>         <span class="keyword">public</span> function <a class="code" href="../../d0/dcf/classOUT__Template.html#a2f0cd6dd6fe55fbc4926cfa10bf48abb">getOption</a>($option) {
<a name="l00106"></a>00106                 <span class="keywordflow">return</span> isset($this-&gt;values[$option]) ? $this-&gt;values[$option] : <span class="keyword">false</span>;
<a name="l00107"></a>00107         }
<a name="l00108"></a>00108 
<a name="l00118"></a><a class="code" href="../../d0/dcf/classOUT__Template.html#a068a09ea40b27447cbf3cd4540939a8e">00118</a>         <span class="keyword">public</span> function <a class="code" href="../../d0/dcf/classOUT__Template.html#a068a09ea40b27447cbf3cd4540939a8e">putOption</a>($option, $value) {
<a name="l00119"></a>00119                 <span class="keywordflow">if</span>(!is_string($option) || !is_string($value)) {
<a name="l00120"></a>00120                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00121"></a>00121                 } $this-&gt;values[$option] = $value;
<a name="l00122"></a>00122                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00123"></a>00123         }
<a name="l00124"></a>00124 
<a name="l00131"></a><a class="code" href="../../d0/dcf/classOUT__Template.html#a87d9c155f0467841a0ce3a61c6131f5e">00131</a>         <span class="keyword">public</span> function <a class="code" href="../../d0/dcf/classOUT__Template.html#a87d9c155f0467841a0ce3a61c6131f5e">execute</a>() {
<a name="l00132"></a>00132                 $pattern  = <span class="stringliteral">&apos;(&lt;!([a-zA-Z0-9]*)\[\[([a-zA-Z0-9]+)\]\]&gt;)&apos;</span>;
<a name="l00133"></a>00133                 $callback = array(&amp;$this, <span class="stringliteral">&apos;replaceTag&apos;</span>);
<a name="l00134"></a>00134                 $subject  = $this-&gt;<span class="keyword">template</span>;
<a name="l00135"></a>00135                 <span class="keywordflow">return</span> preg_replace_callback($pattern, $callback, $subject);
<a name="l00136"></a>00136         }
<a name="l00137"></a>00137 
<a name="l00151"></a><a class="code" href="../../d0/dcf/classOUT__Template.html#a851f1584ccf3a08203c13b89b9b18c95">00151</a>         <span class="keyword">private</span> function <a class="code" href="../../d0/dcf/classOUT__Template.html#a851f1584ccf3a08203c13b89b9b18c95">replaceTag</a>($matches) {
<a name="l00152"></a>00152                 <span class="comment">// Retrieve variables:</span>
<a name="l00153"></a>00153                 <span class="comment">//    whole      - Entire tag</span>
<a name="l00154"></a>00154                 <span class="comment">//    rawoptions - Options before being processed (separated, etc.)</span>
<a name="l00155"></a>00155                 <span class="comment">//    options    - Options specified in the tag</span>
<a name="l00156"></a>00156                 <span class="comment">//    tagname    - Name of the tag</span>
<a name="l00157"></a>00157                 <span class="comment">//    value      - Value corresponding to the tag name</span>
<a name="l00158"></a>00158                 $whole      = $matches[0];
<a name="l00159"></a>00159                 $rawoptions = strpos($matches[1], <span class="charliteral">&apos;,&apos;</span>) ? implode(<span class="charliteral">&apos;,&apos;</span>, $matches[1]) : array();
<a name="l00160"></a>00160                 $tagname    = trim($matches[2]);
<a name="l00161"></a>00161                 $value      = isset($this-&gt;values[$tagname]) ? $this-&gt;values[$tagname] : <span class="keyword">false</span>;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163                 <span class="comment">// Put options into proper array</span>
<a name="l00164"></a>00164                 $options = array();
<a name="l00165"></a>00165                 <span class="keywordflow">foreach</span>($rawoptions as $key =&gt; $value) {
<a name="l00166"></a>00166                         $temp = explode(<span class="charliteral">&apos;=&apos;</span>, $value);
<a name="l00167"></a>00167                         <span class="keywordflow">if</span>(isset($temp[1])) {
<a name="l00168"></a>00168                                 <span class="keywordflow">if</span>($temp[1] === <span class="keyword">true</span>) { $options[$temp[0]]  = <span class="keyword">true</span>;  }
<a name="l00169"></a>00169                                 <span class="keywordflow">if</span>($temp[1] === <span class="keyword">false</span>) { $options[$temp[0]] = <span class="keyword">false</span>; }
<a name="l00170"></a>00170                                 $options[$temp[0]] = $temp[1];
<a name="l00171"></a>00171                         } <span class="keywordflow">else</span> {
<a name="l00172"></a>00172                                 $options[$temp[0]] = <span class="keyword">true</span>;
<a name="l00173"></a>00173                         }
<a name="l00174"></a>00174                 }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176                 <span class="comment">// If the template option is set, stop here and load the second template.</span>
<a name="l00177"></a>00177                 <span class="keywordflow">if</span>(array_key_exists(<span class="stringliteral">&apos;template&apos;</span>, $options)) {
<a name="l00178"></a>00178                         <a class="code" href="../../d0/dcf/classOUT__Template.html#a296bfcd3d6b713859bd81c827d87aa3e">$filename</a> = dirname($this-&gt;filename) . <span class="stringliteral">&quot;/$tagname.template&quot;</span>;
<a name="l00179"></a>00179                         <a class="code" href="../../d0/dcf/classOUT__Template.html#a1c04c575b35949f8146c1a5eef5c2ed7">$template</a> = <span class="keyword">new</span> <a class="code" href="../../d0/dcf/classOUT__Template.html">OUT_Template</a>(<a class="code" href="../../d0/dcf/classOUT__Template.html#a296bfcd3d6b713859bd81c827d87aa3e">$filename</a>);
<a name="l00180"></a>00180                         $value    = <a class="code" href="../../d0/dcf/classOUT__Template.html#a1c04c575b35949f8146c1a5eef5c2ed7">$template</a>-&gt;execute();
<a name="l00181"></a>00181                         $options[<span class="stringliteral">&apos;noescape&apos;</span>] = <span class="keyword">true</span>;
<a name="l00182"></a>00182                 }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184                 <span class="comment">// If array option is set, value should be an array of items.</span>
<a name="l00185"></a>00185                 <span class="comment">// Items are individually escaped, and then imploded using the given</span>
<a name="l00186"></a>00186                 <span class="comment">// option value as the glue. If the noescape option is set, the array</span>
<a name="l00187"></a>00187                 <span class="comment">// values will not be escaped.</span>
<a name="l00188"></a>00188                 <span class="keywordflow">if</span>(array_key_exists(<span class="stringliteral">&apos;array&apos;</span>, $options) &amp;&amp; !empty($options[<span class="stringliteral">&apos;array&apos;</span>])) {
<a name="l00189"></a>00189                         $separator = $options[<span class="stringliteral">&apos;array&apos;</span>];
<a name="l00190"></a>00190                         <span class="keywordflow">foreach</span>($value as &amp;$curval) {
<a name="l00191"></a>00191                                 <span class="keywordflow">if</span>( !(array_key_exists(<span class="stringliteral">&apos;noescape&apos;</span>, $options)  &amp;&amp;  $options[<span class="stringliteral">&apos;noescape&apos;</span>]) &amp;&amp;
<a name="l00192"></a>00192                                     (!array_key_exists(<span class="stringliteral">&apos;escape&apos;</span>,   $options) ||  $options[<span class="stringliteral">&apos;escape&apos;</span>]  )) {
<a name="l00193"></a>00193                                         $curval = htmlentities($curvalue);
<a name="l00194"></a>00194                                 }
<a name="l00195"></a>00195                         }
<a name="l00196"></a>00196                         $options[<span class="stringliteral">&apos;noescape&apos;</span>] = <span class="keyword">true</span>;
<a name="l00197"></a>00197                         <span class="keywordflow">if</span>(!is_array($value)) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
<a name="l00198"></a>00198                         $value = implode($separator, $value);
<a name="l00199"></a>00199                 }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201                 <span class="comment">// If the switch option is set, instead of using the value as content, evaluate it</span>
<a name="l00202"></a>00202                 <span class="comment">// as true or false, to see which of two static given values to use.</span>
<a name="l00203"></a>00203                 <span class="keywordflow">if</span>(array_key_exists(<span class="stringliteral">&apos;switch&apos;</span>,       $options) &amp;&amp;
<a name="l00204"></a>00204                    array_key_exists(<span class="stringliteral">&apos;switch_true&apos;</span>,  $options) &amp;&amp;
<a name="l00205"></a>00205                    array_key_exists(<span class="stringliteral">&apos;switch_false&apos;</span>, $options)     ) {
<a name="l00206"></a>00206                         <span class="keywordflow">if</span>($value) {
<a name="l00207"></a>00207                                 $value = $options[<span class="stringliteral">&apos;switch_true&apos;</span>];
<a name="l00208"></a>00208                         } <span class="keywordflow">else</span> {
<a name="l00209"></a>00209                                 $value = $options[<span class="stringliteral">&apos;switch_false&apos;</span>];
<a name="l00210"></a>00210                         } $options[<span class="stringliteral">&apos;noescape&apos;</span>] = <span class="keyword">true</span>;
<a name="l00211"></a>00211                 }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213                 <span class="comment">// Unless noescape option is set to true,</span>
<a name="l00214"></a>00214                 <span class="comment">// or escape option is set to false, escape value.</span>
<a name="l00215"></a>00215                 <span class="keywordflow">if</span>( !(array_key_exists(<span class="stringliteral">&apos;noescape&apos;</span>, $options)  &amp;&amp;  $options[<span class="stringliteral">&apos;noescape&apos;</span>]) &amp;&amp;
<a name="l00216"></a>00216                      (!array_key_exists(<span class="stringliteral">&apos;escape&apos;</span>,   $options) ||  $options[<span class="stringliteral">&apos;escape&apos;</span>]  )) {
<a name="l00217"></a>00217                         $value = htmlentities($value);
<a name="l00218"></a>00218                 }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220                 <span class="comment">// If trim is set, trim value to certain length.</span>
<a name="l00221"></a>00221                 <span class="keywordflow">if</span>(array_key_exists(<span class="stringliteral">&apos;trim&apos;</span>, $options) &amp;&amp; $options[<span class="stringliteral">&apos;trim&apos;</span>] !== <span class="keyword">true</span>) {
<a name="l00222"></a>00222                         $value = substr(0, $options[<span class="stringliteral">&apos;trim&apos;</span>]);
<a name="l00223"></a>00223                 }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225                 <span class="comment">// If padding is set, pad value to that number of characters.</span>
<a name="l00226"></a>00226                 <span class="comment">// Default padding is whitespace. Use padvalue to set otherwise.</span>
<a name="l00227"></a>00227                 <span class="keywordflow">if</span>(array_key_exists(<span class="stringliteral">&apos;padding&apos;</span>, $options) &amp;&amp; $options[<span class="stringliteral">&apos;padding&apos;</span>] !== <span class="keyword">true</span>) {
<a name="l00228"></a>00228                         $padlen = $options[<span class="stringliteral">&apos;padding&apos;</span>];
<a name="l00229"></a>00229                         $padval = array_key_exists(<span class="stringliteral">&apos;padvalue&apos;</span>, $options) &amp;&amp; !empty($options[<span class="stringliteral">&apos;padvalue&apos;</span>]) ?
<a name="l00230"></a>00230                                                $padvalue : <span class="charliteral">&apos; &apos;</span>;
<a name="l00231"></a>00231                         $value = str_pad($value, $padlen, $padval);
<a name="l00232"></a>00232                 }
<a name="l00233"></a>00233 
<a name="l00234"></a>00234                 <span class="keywordflow">return</span> $value;
<a name="l00235"></a>00235         }
<a name="l00236"></a>00236 }
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Thu Jan 28 21:25:45 2010 for WebApi by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
