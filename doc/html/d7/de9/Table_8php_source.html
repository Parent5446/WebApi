<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WebApi: app/db/Table.php Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="../../dir_a261379d24894f08009c147cca3fa917.html">app</a>&nbsp;&raquo&nbsp;<a class="el" href="../../dir_56c552828a38646e28416eb1522e065d.html">db</a>
  </div>
</div>
<div class="contents">
<h1>Table.php</h1><a href="../../d7/de9/Table_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="keywordflow">if</span>(!defined(<span class="stringliteral">&quot;API&quot;</span>)) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
<a name="l00004"></a>00004 
<a name="l00040"></a><a class="code" href="../../d6/d90/classDB__Table.html">00040</a> <span class="keyword">class </span><a class="code" href="../../d6/d90/classDB__Table.html">DB_Table</a>
<a name="l00041"></a>00041 {
<a name="l00046"></a><a class="code" href="../../d6/d90/classDB__Table.html#a41dba64f7c42ebc3a036f391b2efad71">00046</a>         <span class="keyword">private</span> <a class="code" href="../../d6/d90/classDB__Table.html#a41dba64f7c42ebc3a036f391b2efad71">$database</a>;
<a name="l00047"></a>00047 
<a name="l00052"></a><a class="code" href="../../d6/d90/classDB__Table.html#a3ac5f49ea8620ff9f514d767e745f14f">00052</a>         <span class="keyword">private</span> <a class="code" href="../../d6/d90/classDB__Table.html#a3ac5f49ea8620ff9f514d767e745f14f">$tablename</a>;
<a name="l00053"></a>00053 
<a name="l00060"></a><a class="code" href="../../d6/d90/classDB__Table.html#ae1cbbd01f9100d98db4de61e11ccfab2">00060</a>         <span class="keyword">public</span> function <a class="code" href="../../d6/d90/classDB__Table.html#ae1cbbd01f9100d98db4de61e11ccfab2">__construct</a>(&amp;<a class="code" href="../../d6/d90/classDB__Table.html#a41dba64f7c42ebc3a036f391b2efad71">$database</a>, <a class="code" href="../../d6/d90/classDB__Table.html#a3ac5f49ea8620ff9f514d767e745f14f">$tablename</a>) {
<a name="l00061"></a>00061                 $this-&gt;log =&amp; <a class="code" href="../../d6/d90/classDB__Table.html#a41dba64f7c42ebc3a036f391b2efad71">$database</a>-&gt;getLog();
<a name="l00062"></a>00062 
<a name="l00063"></a>00063                 <span class="keywordflow">if</span>(!<a class="code" href="../../d6/d90/classDB__Table.html#a41dba64f7c42ebc3a036f391b2efad71">$database</a> instanceof <a class="code" href="../../d3/d63/classDB__Database.html">DB_Database</a>) {
<a name="l00064"></a>00064                         <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="../../d4/d5e/classMAIN__Error.html">MAIN_Error</a>(<a class="code" href="../../d4/d5e/classMAIN__Error.html#a8dd94ca1db9a48b21bad30ed114e7fbe">MAIN_Error::ERROR</a>, <span class="stringliteral">&apos;DB_Table::__construct&apos;</span>, <span class="stringliteral">&apos;Given Database object is not valid.&apos;</span>, $this-&gt;log);
<a name="l00065"></a>00065                 }
<a name="l00066"></a>00066 
<a name="l00067"></a>00067                 $this-&gt;database  =&amp; <a class="code" href="../../d6/d90/classDB__Table.html#a41dba64f7c42ebc3a036f391b2efad71">$database</a>;
<a name="l00068"></a>00068                 $this-&gt;tablename =  <a class="code" href="../../d6/d90/classDB__Table.html#a3ac5f49ea8620ff9f514d767e745f14f">$tablename</a>;
<a name="l00069"></a>00069         }
<a name="l00070"></a>00070 
<a name="l00076"></a><a class="code" href="../../d6/d90/classDB__Table.html#a3c86c1069485a5bdff2e4152b8485443">00076</a>         <span class="keyword">public</span> function &amp;<a class="code" href="../../d6/d90/classDB__Table.html#a3c86c1069485a5bdff2e4152b8485443">getLog</a>() {
<a name="l00077"></a>00077                 <span class="keywordflow">return</span> $this-&gt;log;
<a name="l00078"></a>00078         }
<a name="l00079"></a>00079 
<a name="l00089"></a><a class="code" href="../../d6/d90/classDB__Table.html#a88064818e52f2002d18849600e077239">00089</a>         <span class="keyword">public</span> function <a class="code" href="../../d6/d90/classDB__Table.html#a88064818e52f2002d18849600e077239">query</a>($sql) {
<a name="l00090"></a>00090                 $sql = <span class="stringliteral">&quot;/* tablename: {$this-&gt;tablename} */ &quot;</span> . $sql;
<a name="l00091"></a>00091                 <span class="keywordflow">return</span> $this-&gt;database-&gt;query($sql);
<a name="l00092"></a>00092         }
<a name="l00093"></a>00093 
<a name="l00104"></a><a class="code" href="../../d6/d90/classDB__Table.html#a041e54ac21aac399fb9ba2f6227554b1">00104</a>         <span class="keyword">public</span> function <a class="code" href="../../d6/d90/classDB__Table.html#a041e54ac21aac399fb9ba2f6227554b1">result</a>($res, $type = <span class="stringliteral">&quot;array&quot;</span>) {
<a name="l00105"></a>00105                 <span class="keywordflow">return</span> $this-&gt;database-&gt;result($res, $type = <span class="stringliteral">&quot;array&quot;</span>);
<a name="l00106"></a>00106         }
<a name="l00107"></a>00107 
<a name="l00119"></a><a class="code" href="../../d6/d90/classDB__Table.html#a32f3e1b7ac33c40432f6204cc0af8b66">00119</a>         <span class="keyword">public</span> function <a class="code" href="../../d6/d90/classDB__Table.html#a32f3e1b7ac33c40432f6204cc0af8b66">escape</a>($var) {
<a name="l00120"></a>00120                 <span class="keywordflow">if</span>(is_array($var)) {
<a name="l00121"></a>00121                         <span class="comment">// Escape all keys and values.</span>
<a name="l00122"></a>00122                         $newvar = array();
<a name="l00123"></a>00123                         <span class="keywordflow">foreach</span>($var as $key =&gt; $value) {
<a name="l00124"></a>00124                                 $newvar[$this-&gt;database-&gt;escape($key)] = $this-&gt;database-&gt;escape($value);
<a name="l00125"></a>00125                         }
<a name="l00126"></a>00126                 } elseif(is_string($var)) {
<a name="l00127"></a>00127                         <span class="comment">// Escape just the variable.</span>
<a name="l00128"></a>00128                         $newvar = $this-&gt;database-&gt;escape($var);
<a name="l00129"></a>00129                 } elseif(is_int($var) || is_float($var)) {
<a name="l00130"></a>00130                         $newvar = $var;
<a name="l00131"></a>00131                 } <span class="keywordflow">else</span> {
<a name="l00132"></a>00132                         <span class="comment">// Bad variable type.</span>
<a name="l00133"></a>00133                         $newvar = <span class="keyword">false</span>;
<a name="l00134"></a>00134                 } <span class="keywordflow">return</span> $newvar;
<a name="l00135"></a>00135         }
<a name="l00136"></a>00136 
<a name="l00150"></a><a class="code" href="../../d6/d90/classDB__Table.html#a9d3c4b24a4c0d7218dd6b4f376a1aa9b">00150</a>         <span class="keyword">public</span> function <a class="code" href="../../d6/d90/classDB__Table.html#a9d3c4b24a4c0d7218dd6b4f376a1aa9b">select</a>($fields = <span class="charliteral">&apos;*&apos;</span>, $where = <span class="stringliteral">&apos;&apos;</span>, $conditional = <span class="stringliteral">&apos;AND&apos;</span>, $options = array()) {
<a name="l00151"></a>00151                 <span class="comment">// Escape data and implode if an array.</span>
<a name="l00152"></a>00152                 $fields = $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#a32f3e1b7ac33c40432f6204cc0af8b66">escape</a>($fields);
<a name="l00153"></a>00153                 <span class="keywordflow">if</span>(is_array($fields)) {
<a name="l00154"></a>00154                         $fields = implode(<span class="charliteral">&apos;,&apos;</span>, $fields);
<a name="l00155"></a>00155                 }
<a name="l00156"></a>00156 
<a name="l00157"></a>00157                 <span class="comment">// WHERE statement and options.</span>
<a name="l00158"></a>00158                 $where   = $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#aee8ad81369c558bcf29a9b4cf0961b41">whereStatement</a>($where, $conditional);
<a name="l00159"></a>00159                 $options = $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#a56bde02ad43e915898c7709e4d2ec75e">optionsStatement</a>($options);
<a name="l00160"></a>00160 
<a name="l00161"></a>00161                 <span class="comment">// Do the query.</span>
<a name="l00162"></a>00162                 $sql = <span class="stringliteral">&quot;SELECT $fields FROM {$this-&gt;tablename} $where $options&quot;</span>;
<a name="l00163"></a>00163                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#a88064818e52f2002d18849600e077239">query</a>($sql);
<a name="l00164"></a>00164         }
<a name="l00165"></a>00165 
<a name="l00177"></a><a class="code" href="../../d6/d90/classDB__Table.html#a843dcb7cc2f8eac5865d05de68d9c0bf">00177</a>         <span class="keyword">public</span> function <a class="code" href="../../d6/d90/classDB__Table.html#a843dcb7cc2f8eac5865d05de68d9c0bf">insert</a>($row, $options = array()) {
<a name="l00178"></a>00178                 <span class="comment">// Return if not an array.</span>
<a name="l00179"></a>00179                 <span class="keywordflow">if</span>(!is_array($row)) {
<a name="l00180"></a>00180                         <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="../../d4/d5e/classMAIN__Error.html">MAIN_Error</a>(<a class="code" href="../../d4/d5e/classMAIN__Error.html#af47cc28f788d73c277a78761621fd711">MAIN_Error::WARNING</a>, <span class="stringliteral">&apos;DB_Table::insert&apos;</span>, <span class="stringliteral">&apos;Parameter is not the correct data type.&apos;</span>, $this-&gt;log);
<a name="l00181"></a>00181                 }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183                 <span class="comment">// Escape and separate list of columns and values.</span>
<a name="l00184"></a>00184                 $row    = $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#a32f3e1b7ac33c40432f6204cc0af8b66">escape</a>($row);
<a name="l00185"></a>00185                 $cols   = implode(<span class="stringliteral">&apos;, &apos;</span>, array_keys($row));
<a name="l00186"></a>00186                 $values = implode(<span class="charliteral">&apos;\&apos;</span>, \<span class="stringliteral">&apos;&apos;</span>,            $row );
<a name="l00187"></a>00187 
<a name="l00188"></a>00188                 <span class="comment">// Options</span>
<a name="l00189"></a>00189                 $options = $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#a56bde02ad43e915898c7709e4d2ec75e">optionsStatement</a>($options);
<a name="l00190"></a>00190 
<a name="l00191"></a>00191                 <span class="comment">// Do the query.</span>
<a name="l00192"></a>00192                 $sql = <span class="stringliteral">&quot;INSERT INTO {$this-&gt;tablename} ($cols) VALUES (&apos;$values&apos;) $options&quot;</span>;
<a name="l00193"></a>00193                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#a88064818e52f2002d18849600e077239">query</a>($sql);
<a name="l00194"></a>00194         }
<a name="l00195"></a>00195 
<a name="l00209"></a><a class="code" href="../../d6/d90/classDB__Table.html#a96ba2b025ea8882eb171eff83749d6be">00209</a>         <span class="keyword">public</span> function <a class="code" href="../../d6/d90/classDB__Table.html#a96ba2b025ea8882eb171eff83749d6be">update</a>($row, $where = <span class="stringliteral">&apos;&apos;</span>, $conditional = <span class="stringliteral">&apos;AND&apos;</span>, $options = array()) {
<a name="l00210"></a>00210                 <span class="comment">// Return if not an array.</span>
<a name="l00211"></a>00211                 <span class="keywordflow">if</span>(!is_array($row)) {
<a name="l00212"></a>00212                         <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="../../d4/d5e/classMAIN__Error.html">MAIN_Error</a>(<a class="code" href="../../d4/d5e/classMAIN__Error.html#af47cc28f788d73c277a78761621fd711">MAIN_Error::WARNING</a>, <span class="stringliteral">&apos;DB_Table::insert&apos;</span>, <span class="stringliteral">&apos;Parameter is not the correct data type.&apos;</span>, $this-&gt;log);
<a name="l00213"></a>00213                 }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215                 <span class="comment">// Escape them implode into usable statement.</span>
<a name="l00216"></a>00216                 $row = $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#a32f3e1b7ac33c40432f6204cc0af8b66">escape</a>($row);
<a name="l00217"></a>00217                 <span class="keywordflow">foreach</span>($row as $key =&gt; &amp;$value) {
<a name="l00218"></a>00218                         $value = <span class="stringliteral">&quot;$key=&apos;$value&apos; &quot;</span>;
<a name="l00219"></a>00219                 } $values = implode(<span class="stringliteral">&quot;, &quot;</span>, $row);
<a name="l00220"></a>00220 
<a name="l00221"></a>00221                 <span class="comment">// WHERE statement and options.</span>
<a name="l00222"></a>00222                 $where   = $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#aee8ad81369c558bcf29a9b4cf0961b41">whereStatement</a>($where, $conditional);
<a name="l00223"></a>00223                 $options = $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#a56bde02ad43e915898c7709e4d2ec75e">optionsStatement</a>($options);
<a name="l00224"></a>00224 
<a name="l00225"></a>00225                 <span class="comment">// Do the query.</span>
<a name="l00226"></a>00226                 $sql = <span class="stringliteral">&quot;UPDATE {$this-&gt;tablename} SET $values $where $options&quot;</span>;
<a name="l00227"></a>00227                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#a88064818e52f2002d18849600e077239">query</a>($sql);
<a name="l00228"></a>00228         }
<a name="l00229"></a>00229 
<a name="l00242"></a><a class="code" href="../../d6/d90/classDB__Table.html#a2374e86114f0af3132e4df6d55301628">00242</a>         <span class="keyword">public</span> function <span class="keyword">delete</span>($where = array(), $conditional = <span class="stringliteral">&apos;AND&apos;</span>, $options = array()) {
<a name="l00243"></a>00243                 <span class="comment">// WHERE statement and options.</span>
<a name="l00244"></a>00244                 $where   = $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#aee8ad81369c558bcf29a9b4cf0961b41">whereStatement</a>($where, $conditional);
<a name="l00245"></a>00245                 $options = $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#a56bde02ad43e915898c7709e4d2ec75e">optionsStatement</a>($options);
<a name="l00246"></a>00246 
<a name="l00247"></a>00247                 <span class="comment">// Do the query.</span>
<a name="l00248"></a>00248                 $sql = <span class="stringliteral">&quot;DELETE FROM {$this-&gt;tablename} $where $options&quot;</span>;
<a name="l00249"></a>00249                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#a88064818e52f2002d18849600e077239">query</a>($sql);
<a name="l00250"></a>00250         }
<a name="l00251"></a>00251 
<a name="l00257"></a><a class="code" href="../../d6/d90/classDB__Table.html#a480182430c70002f3b780a9d76be91b9">00257</a>         <span class="keyword">public</span> function <a class="code" href="../../d6/d90/classDB__Table.html#a480182430c70002f3b780a9d76be91b9">columns</a>() {
<a name="l00258"></a>00258                 $res = $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#a88064818e52f2002d18849600e077239">query</a>(<span class="stringliteral">&quot;SHOW COLUMNS FROM {$this-&gt;tablename}&quot;</span>);
<a name="l00259"></a>00259                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#a041e54ac21aac399fb9ba2f6227554b1">result</a>($res ,<span class="stringliteral">&apos;assoc&apos;</span>);
<a name="l00260"></a>00260         }
<a name="l00261"></a>00261 
<a name="l00270"></a><a class="code" href="../../d6/d90/classDB__Table.html#aee8ad81369c558bcf29a9b4cf0961b41">00270</a>         <span class="keyword">private</span> function <a class="code" href="../../d6/d90/classDB__Table.html#aee8ad81369c558bcf29a9b4cf0961b41">whereStatement</a>($where, $conditional) {
<a name="l00271"></a>00271                 <span class="comment">// Check if it is an array.</span>
<a name="l00272"></a>00272                 <span class="keywordflow">if</span>(is_array($where)) {
<a name="l00273"></a>00273                         <span class="comment">// Start off the statement and escape.</span>
<a name="l00274"></a>00274                         $tmp = <span class="stringliteral">&apos;WHERE &apos;</span>;
<a name="l00275"></a>00275                         $where = $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#a32f3e1b7ac33c40432f6204cc0af8b66">escape</a>($where);
<a name="l00276"></a>00276 
<a name="l00277"></a>00277                         <span class="comment">// Combine and implode values.</span>
<a name="l00278"></a>00278                         <span class="keywordflow">foreach</span>($where as $key =&gt; &amp;$value) {
<a name="l00279"></a>00279                                 $value = <span class="stringliteral">&quot;$key=&apos;$value&apos; &quot;</span>;
<a name="l00280"></a>00280                         } $tmp .= implode(<span class="stringliteral">&quot; $conditional &quot;</span>, $where);
<a name="l00281"></a>00281 
<a name="l00282"></a>00282                         <span class="comment">// Return final value</span>
<a name="l00283"></a>00283                         <span class="keywordflow">return</span> $tmp;
<a name="l00284"></a>00284                 } <span class="keywordflow">else</span> {
<a name="l00285"></a>00285                         <span class="comment">// Bad variable type.</span>
<a name="l00286"></a>00286                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00287"></a>00287                 }
<a name="l00288"></a>00288         }
<a name="l00289"></a>00289 
<a name="l00298"></a><a class="code" href="../../d6/d90/classDB__Table.html#a56bde02ad43e915898c7709e4d2ec75e">00298</a>         <span class="keyword">private</span> function <a class="code" href="../../d6/d90/classDB__Table.html#a56bde02ad43e915898c7709e4d2ec75e">optionsStatement</a>($options) {
<a name="l00299"></a>00299                 <span class="comment">// Escape, combine, implode.</span>
<a name="l00300"></a>00300                 $options = $this-&gt;<a class="code" href="../../d6/d90/classDB__Table.html#a32f3e1b7ac33c40432f6204cc0af8b66">escape</a>($options);
<a name="l00301"></a>00301                 <span class="keywordflow">foreach</span>($options as $key =&gt; &amp;$value) {
<a name="l00302"></a>00302                         $value = <span class="stringliteral">&quot;$key $value &quot;</span>;
<a name="l00303"></a>00303                 } <span class="keywordflow">return</span> implode(<span class="charliteral">&apos; &apos;</span>, $options);
<a name="l00304"></a>00304         }
<a name="l00305"></a>00305 }
<a name="l00306"></a>00306 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Thu Jan 28 21:25:45 2010 for WebApi by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
